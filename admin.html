<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üìà –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ê–∫–∞–¥–µ–º–∏–∏ –ö–æ–Ω–æ—Ö–∏</title>
    <style>
        body { font-family: Arial; background: #1a3c1a; color: white; padding: 30px; }
        .container {
            max-width: 1200px; margin: 0 auto;
            background: rgba(255,255,255,0.1);
            border-radius: 20px; padding: 30px;
            backdrop-filter: blur(10px);
        }
        table {
            width: 100%; border-collapse: collapse; margin-top: 20px;
            background: rgba(255,255,255,0.15); border-radius: 15px; overflow: hidden;
        }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); }
        th {
            background: linear-gradient(45deg, #ff6600, #ffcc00);
            color: #1a1a1a; font-weight: bold;
        }
        tr:hover { background: rgba(255,255,255,0.2); }
        .top3 { background: linear-gradient(45deg, gold, orange) !important; font-weight: bold; }
        .refresh {
            padding: 15px 30px; background: #00cc00; color: white;
            border: none; border-radius: 20px; cursor: pointer;
            font-size: 1.1em; margin-bottom: 20px; margin-right: 10px;
        }
        .danger { background: #cc0000; }
        .stats { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat {
            background: rgba(255,255,255,0.2);
            padding: 20px; border-radius: 15px; text-align: center;
        }
        .delete-btn {
            padding: 5px 10px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            background: #cc0000;
            color: #fff;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçÉ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ê–∫–∞–¥–µ–º–∏–∏ –°–∏–Ω–æ–±–∏ üçÉ</h1>
        <button class="refresh" onclick="loadResults()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        <button class="refresh danger" onclick="deleteAll()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>

        <div class="stats" id="stats"></div>
        <table id="resultsTable">
            <thead>
                <tr>
                    <th>–ú–µ—Å—Ç–æ</th><th>–ù–∏–∫</th><th>–ë–∞–ª–ª</th><th>%</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–∞—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
        </table>
    </div>

    <script>
        const API_URL = 'https://sheetdb.io/api/v1/4ssoqxhf0fnia';

        async function loadResults() {
            try {
                const response = await fetch(API_URL);
                let results = await response.json();

                results.sort((a,b) => parseInt(b.percent || 0) - parseInt(a.percent || 0));

                const total = results.length;
                const passed = results.filter(r => (r.status === '–ü—Ä–æ—à—ë–ª')).length;
                const best = results[0] ? (results[0].percent || 0) : 0;

                document.getElementById('stats').innerHTML = `
                    <div class="stat">üë• –í—Å–µ–≥–æ: ${total}</div>
                    <div class="stat">‚úÖ –°–¥–∞–ª–∏: ${passed}</div>
                    <div class="stat">ü•á –õ—É—á—à–∏–π: ${best}%</div>
                `;

                const tbody = results.map((r,i) => `
                    <tr ${i < 3 ? 'class="top3"' : ''}>
                        <td>${i+1}üèÜ</td>
                        <td><strong>${r.name || '-'}</strong></td>
                        <td>${r.score !== undefined ? r.score : '-'} / ${r.total || '-'}</td>
                        <td><strong>${r.percent || 0}%</strong></td>
                        <td>${r.status || '-'}</td>
                        <td>${r.date || '-'}</td>
                        <td><button class="delete-btn" onclick="deleteRow(${i})">–£–¥–∞–ª–∏—Ç—å</button></td>
                    </tr>
                `).join('');

                document.getElementById('resultsTable').innerHTML = `
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th><th>–ù–∏–∫</th><th>–ë–∞–ª–ª</th><th>%</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–∞—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>${tbody}</tbody>
                `;
            } catch(e) {
                document.getElementById('resultsTable').innerHTML =
                    '<tr><td colspan="7">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏‚Ä¶</td></tr>';
            }
        }

        async function deleteRow(index) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç?')) return;
            try {
                const response = await fetch(API_URL);
                let results = await response.json();
                if (!results[index]) return;

                const name = results[index].name;
                const date = results[index].date;

                await fetch(`${API_URL}/name/${encodeURIComponent(name)}/date/${encodeURIComponent(date)}`, {
                    method: 'DELETE'
                });

                loadResults();
            } catch(e) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å.');
            }
        }

        async function deleteAll() {
            if (!confirm('–¢–æ—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –í–°–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?')) return;
            try {
                await fetch(API_URL + '/all', { method: 'DELETE' });
                loadResults();
            } catch(e) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É.');
            }
        }

        loadResults();
        setInterval(loadResults, 10000);
    </script>
</body>
</html>
